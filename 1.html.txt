<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Викторина по персидским глаголам</title>
<style>
  body {
    font-family: Arial, sans-serif;
    font-size: 24px;
    padding: 20px;
  }
  #quiz-container {
    margin-top: 20px;
  }
  #question {
    font-weight: bold;
    margin-bottom: 15px;
  }
  #answers button {
    display: block;
    margin: 10px 0;
    padding: 15px;
    font-size: 22px;
    width: 100%;
    cursor: pointer;
  }
  #nextBtn {
    margin-top: 20px;
    padding: 15px;
    font-size: 22px;
  }
  #file-input {
    font-size: 20px;
  }
</style>
</head>
<body>

<h1>Викторина: Персидские глаголы</h1>
<p>Загрузите Excel-файл с глаголами и их переводами.</p>
<input type="file" id="file-input" accept=".xlsx,.xls" />

<div id="quiz-container" style="display:none;">
  <div id="question"></div>
  <div id="answers"></div>
  <button id="nextBtn" onclick="nextQuestion()" disabled>Следующий вопрос</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
let data = [];
let currentIndex = 0;

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function createOptions(correctTranslation) {
  let translations = data.map(item => item.russian);
  translations = translations.filter(t => t !== correctTranslation);
  shuffle(translations);
  let options = translations.slice(0, 5);
  options.push(correctTranslation);
  shuffle(options);
  return options;
}

function showQuestion() {
  if (currentIndex >= data.length) {
    alert("Викторина закончена!");
    document.getElementById('quiz-container').style.display = 'none';
    return;
  }

  document.getElementById('nextBtn').disabled = true;
  let questionObj = data[currentIndex];
  document.getElementById('question').textContent = `Персидское слово: ${questionObj.persian}`;
  
  let answersDiv = document.getElementById('answers');
  answersDiv.innerHTML = '';
  
  let options = createOptions(questionObj.russian);
  options.forEach(option => {
    let btn = document.createElement('button');
    btn.textContent = option;
    btn.onclick = () => {
      if(option === questionObj.russian) {
        alert('Верно!');
      } else {
        alert(`Неверно. Правильный ответ: ${questionObj.russian}`);
      }
      document.getElementById('nextBtn').disabled = false;
      Array.from(answersDiv.children).forEach(b => b.disabled = true);
    };
    answersDiv.appendChild(btn);
  });
}

function nextQuestion() {
  currentIndex++;
  showQuestion();
}

document.getElementById('file-input').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(evt) {
    const dataXLSX = evt.target.result;
    const workbook = XLSX.read(dataXLSX, {type: 'binary'});
    const firstSheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[firstSheetName];
    const jsonData = XLSX.utils.sheet_to_json(sheet, {header: 1});

    // Очищаем и парсим данные
    data = [];
    for(let i=0; i<jsonData.length; i++) {
      let row = jsonData[i];
      if(row.length >= 2) {
        // Персидское слово в первом столбце, русский перевод во втором
        data.push({persian: row[0].toString().trim(), russian: row[1].toString().trim()});
      }
    }

    shuffle(data);
    currentIndex = 0;
    document.getElementById('quiz-container').style.display = 'block';
    showQuestion();
  };
  reader.readAsBinaryString(file);
});
</script>

</body>
</html>
